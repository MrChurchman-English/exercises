<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verb Vault – Irregular Verbs Trainer (EN‑only + DE)</title>
  <meta name="description" content="Practice English irregular verbs with one‑clue prompts. Supports English‑only mode, German hints, streaks, accuracy, and retry mistakes.">
  <style>
    :root{ --bg:#0f172a; --card:#0b1221; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --danger:#ef4444; --border:#1f2937; --brand:#60a5fa; }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; color:var(--text);
         background:radial-gradient(900px 500px at 0% 0%, #0b1228 0, #0f172a 70%), #0f172a}
    .container{max-width:980px; margin:0 auto; padding:28px 16px 60px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid var(--border);
          border-radius:18px; box-shadow:0 10px 40px rgba(0,0,0,.25); padding:20px}
    h1{margin:0 0 6px; font-size:clamp(28px,3vw,44px)}
    .tagline{color:#c7d2fe; font-weight:600; letter-spacing:.2px; margin:2px 0 14px}
    .subtitle{color:var(--muted); margin:0 0 16px}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end}
    .col{flex:1 1 220px}
    select,input,button{width:100%; font-size:16px; border-radius:12px; border:1px solid var(--border);
                        background:#0a1529; color:var(--text); padding:12px 14px}
    input[readonly]{opacity:.9; background:#0b1730}
    button{cursor:pointer; background:#0f233f}
    button.primary{background:linear-gradient(90deg,#2563eb,#22d3ee); border:none}
    button.ghost{background:transparent}

    .pill{display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border:1px solid var(--border);
          border-radius:999px; color:var(--muted); font-size:14px}
    .prompt{display:grid; grid-template-columns:repeat(4,minmax(160px,1fr)); gap:12px}
    .input-wrap{position:relative}
    .input-wrap.correct input{outline:2px solid var(--accent)}
    .input-wrap.wrong input{outline:2px solid var(--danger)}
    .helper{position:absolute; top:100%; left:8px; margin-top:6px; font-size:12px; color:var(--muted)}
    .helper.correct{color:var(--accent)}
    .helper.wrong{color:var(--danger)}
    .given-tag{position:absolute; right:8px; top:-8px; background:#0e233f; border:1px solid #203a67; color:#aad2ff; font-size:11px; padding:2px 6px; border-radius:8px}

    .divider{height:1px; background:linear-gradient(90deg,transparent,#22314b,transparent); margin:16px 0}
    .notice{border-left:3px solid var(--brand); padding:12px 14px; background:linear-gradient(180deg, rgba(96,165,250,.12), rgba(96,165,250,.06)); border-radius:12px; margin:10px 0 18px}
    .steps{margin:8px 0 0 0; padding-left:18px}
    .steps li{margin:6px 0}

    table{width:100%; border-collapse:collapse; font-size:15px}
    th,td{padding:8px 6px; border-bottom:1px solid var(--border); text-align:left}
    tr:last-child td{border-bottom:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Verb Vault: Irregular Verbs Trainer</h1>
      <div class="tagline">One clue. You supply the rest.</div>
      <div class="notice">
        <strong>Instructions for students</strong>
        <ol class="steps">
          <li>Choose <em>Mode</em>: <b>English‑only</b> (no German) or <b>English + German</b>.</li>
          <li>Click <b>Start Round</b>. Each item shows <u>one</u> given field (tagged “GIVEN”).</li>
          <li>Type the missing forms in the empty boxes and press <b>Enter</b> (or click <b>Check</b>).</li>
          <li>Use <b>Hint</b> if you’re stuck. At the end, review mistakes and <b>Retry</b> them.</li>
        </ol>
      </div>
      <div class="subtitle">Covers the teacher’s approved list of irregular verbs. Tracks streak and accuracy. Works on phone, tablet, and desktop.</div>
      <div class="card row">
        <div class="col">
          <label for="batch">Items per round</label>
          <select id="batch"><option>10</option><option>15</option><option>20</option><option>30</option><option>All</option></select>
        </div>
        <div class="col">
          <label for="mode">Mode</label>
          <select id="mode">
            <option value="en">English‑only (no German)</option>
            <option value="ende" selected>English + German</option>
          </select>
        </div>
        <div class="col">
          <label for="bias">Clue bias (optional)</label>
          <select id="bias">
            <option value="random" selected>Random</option>
            <option value="base">Prefer Infinitive</option>
            <option value="past">Prefer Past</option>
            <option value="pp">Prefer Participle</option>
            <option value="de">Prefer German</option>
          </select>
        </div>
        <div class="col">
          <label><input id="toggleSound" type="checkbox" checked> Sound effects</label>
        </div>
        <div class="col"><button id="start" class="primary">Start Round</button></div>
      </div>
    </header>

    <section id="play" class="card" style="margin-top:16px; display:none" aria-live="polite">
      <div style="display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-bottom:8px">
        <span class="pill">Item <strong id="pos">0</strong>/<strong id="total">0</strong></span>
        <span class="pill">Streak: <strong id="streak">0</strong></span>
        <span class="pill">Accuracy: <strong id="acc">100%</strong></span>
        <span class="pill">Clue shown: <strong id="clueType">—</strong></span>
        <div style="display:flex; gap:8px">
          <button id="skip" class="ghost">Skip</button>
          <button id="endRound" class="ghost">End round</button>
        </div>
      </div>
      <div class="divider"></div>
      <div id="task"></div>
      <div style="margin-top:14px; display:flex; gap:10px">
        <button id="check" class="primary">Check</button>
        <button id="hint" class="ghost">Hint</button>
      </div>
    </section>

    <section id="summary" class="card" style="margin-top:16px; display:none">
      <h2 style="margin:0 0 6px">Round Summary</h2>
      <div class="subtitle" id="summarySubtitle"></div>
      <div id="mistakeWrap" style="display:none">
        <div class="divider"></div>
        <h3 style="margin:0 0 6px">Review your mistakes</h3>
        <table id="mistakesTable"></table>
      </div>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
        <button id="retryMistakes" class="primary" style="display:none">Retry Mistakes</button>
        <button id="newRound" class="ghost">New Round</button>
      </div>
    </section>
  </div>

<script>
// ===== WebAudio SFX (no external files) =====
let soundOn = true; let AC; const ctx = ()=> (AC ||= new (window.AudioContext||window.webkitAudioContext)());
function tone(f=440, ms=140, type='sine', vol=0.18){ if(!soundOn) return; const a=ctx(), o=a.createOscillator(), g=a.createGain();
  o.type=type; o.frequency.value=f; g.gain.value=vol; o.connect(g); g.connect(a.destination);
  const t=a.currentTime; g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(vol,t+.01); g.gain.exponentialRampToValueAtTime(.0001,t+ms/1000);
  o.start(t); o.stop(t+ms/1000); }
const sfx={ correct(){tone(660,110); setTimeout(()=>tone(880,120),90)}, wrong(){tone(190,220,'sawtooth',.25)}, end(){tone(523,120); setTimeout(()=>tone(659,140),120); setTimeout(()=>tone(784,180),260)} };

// ===== Data (your exact verbs + German) =====
function V(base,past,pp,de){return{base,past:arrToSet(past),pp:arrToSet(pp),pastArr:past,ppArr:pp,de,deSet:deVariants(de)}}
function arrToSet(a){return new Set(a.map(x=>x.toLowerCase()))}
function normSpaces(s){return s.trim().toLowerCase().replace(/\s+/g,' ')}
function normDe(s){return normSpaces(s).replace(/ä/g,'ae').replace(/ö/g,'oe').replace(/ü/g,'ue').replace(/ß/g,'ss')}
function stripParensKeep(s){return s.replace(/[()]/g,'')}
function stripParensDrop(s){return s.replace(/\([^)]*\)/g,'').replace(/\s{2,}/g,' ').trim()}
function deVariants(s){
  const raw = s.replace(/"/g,'');
  const pieces = raw.split(/;|,/).map(x=>x.trim()).filter(Boolean);
  const varSet = new Set();
  for(const p of pieces){
    const a = stripParensKeep(p); const b = stripParensDrop(p);
    if(a) varSet.add(normDe(a)); if(b) varSet.add(normDe(b));
  }
  if(!varSet.size) varSet.add(normDe(raw));
  return varSet;
}
const VERBS=[
  V('be',['was','were'],['been'],'sein'),
  V('beat',['beat'],['beaten'],'schlagen'),
  V('become',['became'],['become'],'werden'),
  V('begin',['began'],['begun'],'beginnen'),
  V('bend',['bent'],['bent'],'beugen'),
  V('bet',['bet'],['bet'],'wetten'),
  V('bite',['bit'],['bitten'],'beissen'),
  V('bleed',['bled'],['bled'],'bluten'),
  V('blow',['blew'],['blown'],'blasen'),
  V('break',['broke'],['broken'],'brechen'),
  V('bring',['brought'],['brought'],'bringen'),
  V('broadcast',['broadcast','broadcasted'],['broadcast','broadcasted'],'(eine Sendung) ausstrahlen'),
  V('build',['built'],['built'],'bauen'),
  V('burn',['burned','burnt'],['burned','burnt'],'brennen'),
  V('burst',['burst'],['burst'],'platzen'),
  V('buy',['bought'],['bought'],'kaufen'),
  V('catch',['caught'],['caught'],'erwischen, fangen'),
  V('choose',['chose'],['chosen'],'auswählen'),
  V('come',['came'],['come'],'kommen'),
  V('cost',['cost'],['cost'],'kosten'),
  V('cut',['cut'],['cut'],'schneiden'),
  V('deal',['dealt'],['dealt'],'handeln'),
  V('dig',['dug'],['dug'],'graben'),
  V('do',['did'],['done'],'tun, machen'),
  V('draw',['drew'],['drawn'],'zeichnen'),
  V('dream',['dreamed','dreamt'],['dreamed','dreamt'],'träumen'),
  V('drink',['drank'],['drunk'],'trinken'),
  V('drive',['drove'],['driven'],'fahren'),
  V('eat',['ate'],['eaten'],'essen'),
  V('fall',['fell'],['fallen'],'fallen'),
  V('feel',['felt'],['felt'],'fühlen'),
  V('feed',['fed'],['fed'],'füttern'),
  V('fight',['fought'],['fought'],'kämpfen'),
  V('find',['found'],['found'],'finden'),
  V('fly',['flew'],['flown'],'fliegen'),
  V('forbid',['forbade','forbad'],['forbidden'],'verbieten'),
  V('forget',['forgot'],['forgotten','forgot'],'vergessen'),
  V('forgive',['forgave'],['forgiven'],'vergeben'),
  V('freeze',['froze'],['frozen'],'gefrieren'),
  V('get',['got'],['got','gotten'],'erhalten, bekommen'),
  V('give',['gave'],['given'],'geben'),
  V('go',['went'],['gone'],'gehen'),
  V('grow',['grew'],['grown'],'wachsen'),
  V('hang',['hung','hanged'],['hung','hanged'],'hängen'),
  V('have',['had'],['had'],'haben'),
  V('hear',['heard'],['heard'],'hören'),
  V('hide',['hid'],['hidden'],'(sich) verstecken'),
  V('hit',['hit'],['hit'],'schlagen'),
  V('hold',['held'],['held'],'halten'),
  V('hurt',['hurt'],['hurt'],'verletzen'),
  V('keep',['kept'],['kept'],'behalten'),
  V('know',['knew'],['known'],'wissen, kennen'),
  V('lay',['laid'],['laid'],'legen'),
  V('lead',['led'],['led'],'führen'),
  V('leap',['leapt','leaped'],['leapt','leaped'],'springen'),
  V('learn',['learned','learnt'],['learned','learnt'],'lernen'),
  V('leave',['left'],['left'],'gehen, verlassen'),
  V('lend',['lent'],['lent'],'(ver)leihen'),
  V('let',['let'],['let'],'lassen'),
  V('lie',['lay'],['lain'],'liegen'),
  V('light',['lit','lighted'],['lit','lighted'],'anzünden, beleuchten'),
  V('lose',['lost'],['lost'],'verlieren'),
  V('make',['made'],['made'],'machen'),
  V('mean',['meant'],['meant'],'bedeuten'),
  V('meet',['met'],['met'],'(sich) treffen'),
  V('mistake',['mistook'],['mistaken'],'(falsch) verstehen, verwechseln'),
  V('pay',['paid'],['paid'],'bezahlen'),
  V('put',['put'],['put'],'stellen, legen'),
  V('read',['read'],['read'],'lesen'),
  V('ride',['rode'],['ridden'],'reiten'),
  V('ring',['rang'],['rung'],'läuten'),
  V('rise',['rose'],['risen'],'aufgehen'),
  V('run',['ran'],['run'],'rennen'),
  V('say',['said'],['said'],'sagen'),
  V('see',['saw'],['seen'],'sehen'),
  V('sell',['sold'],['sold'],'verkaufen'),
  V('send',['sent'],['sent'],'schicken'),
  V('set',['set'],['set'],'stellen, legen'),
  V('shake',['shook'],['shaken'],'schütteln'),
  V('shine',['shone','shined'],['shone','shined'],'scheinen'),
  V('shoot',['shot'],['shot'],'schiessen, erschiessen'),
  V('show',['showed'],['shown','showed'],'zeigen'),
  V('shrink',['shrank','shrunk'],['shrunk'],'schrumpfen'),
  V('shut',['shut'],['shut'],'schliessen'),
  V('sing',['sang'],['sung'],'singen'),
  V('sink',['sank'],['sunk'],'sinken'),
  V('sit',['sat'],['sat'],'sitzen'),
  V('sleep',['slept'],['slept'],'schlafen'),
  V('slide',['slid'],['slid'],'rutschen'),
  V('smell',['smelled','smelt'],['smelled','smelt'],'riechen'),
  V('speak',['spoke'],['spoken'],'sprechen'),
  V('speed up',['sped up','speeded up'],['sped up','speeded up'],'beschleunigen'),
  V('spell',['spelled','spelt'],['spelled','spelt'],'buchstabieren'),
  V('spend',['spent'],['spent'],'(Geld) ausgeben; (Zeit) verbringen'),
  V('spill',['spilled','spilt'],['spilled','spilt'],'verschütten'),
  V('split',['split'],['split'],'teilen, spalten'),
  V('spread',['spread'],['spread'],'sich ausbreiten'),
  V('stand',['stood'],['stood'],'stehen'),
  V('steal',['stole'],['stolen'],'stehlen'),
  V('stick',['stuck'],['stuck'],'kleben, festsitzen'),
  V('sting',['stung'],['stung'],'stechen'),
  V('swim',['swam'],['swum'],'schwimmen'),
  V('take',['took'],['taken'],'nehmen'),
  V('teach',['taught'],['taught'],'lehren, unterrichten'),
  V('tear',['tore'],['torn'],'zerreissen'),
  V('tell',['told'],['told'],'sagen'),
  V('think',['thought'],['thought'],'denken, glauben'),
  V('throw',['threw'],['thrown'],'werfen'),
  V('understand',['understood'],['understood'],'verstehen'),
  V('wake',['woke'],['woken'],'wecken'),
  V('wear',['wore'],['worn'],'(Kleider) tragen'),
  V('win',['won'],['won'],'gewinnen'),
  V('write',['wrote'],['written'],'schreiben')
];

// ===== State =====
let pool=[], idx=0, streak=0, correct=0, asked=0, mistakes=[], current=null;
const $=id=>document.getElementById(id);

// ===== Controls =====
$('start').addEventListener('click', startRound);
$('toggleSound').addEventListener('change', e=>{soundOn=e.target.checked});
$('check').addEventListener('click', checkAnswer);
$('hint').addEventListener('click', ()=>hint());
$('skip').addEventListener('click', ()=>{idx++; next()});
$('endRound').addEventListener('click', endRound);
$('newRound').addEventListener('click', ()=>{ $('summary').style.display='none'; startRound(); });
window.addEventListener('keydown', e=>{ if($('play').style.display!=='none' && e.key==='Enter'){ e.preventDefault(); checkAnswer(); } });

function startRound(){
  const n= ($('batch').value==='All')? VERBS.length : parseInt($('batch').value,10);
  pool = sample(VERBS,n); idx=0; streak=0; correct=0; asked=0; mistakes=[]; current=null;
  $('total').textContent=pool.length; $('pos').textContent='0'; $('streak').textContent='0'; $('acc').textContent='100%';
  $('summary').style.display='none'; $('play').style.display='block';
  next();
}
function next(){ if(idx>=pool.length) return endRound(); const mode=$('mode').value; const bias=$('bias').value; const types = (mode==='en')? ['base','past','pp'] : ['base','past','pp','de'];
  let clue = (bias==='random' || !types.includes(bias))? types[Math.floor(Math.random()*types.length)] : (Math.random()<0.7?bias:types[Math.floor(Math.random()*types.length)]);
  current = { v: pool[idx], clue, mode };
  $('pos').textContent=String(idx+1); $('clueType').textContent=clueLabel(clue);
  renderTask();
}
function clueLabel(t){ return t==='base'?'Infinitive': t==='past'?'Past Simple': t==='pp'?'Past Participle':'German'; }

function renderTask(){
  const t=$('task'); t.innerHTML=''; const v=current.v; const clue=current.clue; const showGerman = current.mode==='ende';
  const grid=document.createElement('div'); grid.className='prompt';
  const baseRO = clue==='base'; const pastRO = clue==='past'; const ppRO = clue==='pp'; const deRO = clue==='de' && showGerman;
  grid.appendChild(field('Infinitive','base', baseRO? v.base:'', baseRO));
  grid.appendChild(field('Past Simple','past', pastRO? one(v.pastArr):'', pastRO));
  grid.appendChild(field('Past Participle','pp', ppRO? one(v.ppArr):'', ppRO));
  if(showGerman){ grid.appendChild(field('German','de', deRO? v.de:'', deRO)); }
  t.appendChild(grid);
  const first=t.querySelector('input:not([readonly])'); if(first){ first.focus(); first.select(); }
}

function field(label,name,value='',ro=false){ const w=document.createElement('div'); w.className='input-wrap';
  const l=document.createElement('label'); l.textContent=label; const i=document.createElement('input'); i.type='text'; i.id='in_'+name; i.value=value; if(ro){i.readOnly=true}
  const h=document.createElement('div'); h.className='helper'; h.id='help_'+name; if(ro){ const tag=document.createElement('div'); tag.className='given-tag'; tag.textContent='GIVEN'; w.append(tag); }
  w.append(l,i,h); return w; }

function normalizeEN(s){ return normSpaces(s); }
function checkAnswer(){ const v=current.v; const clue=current.clue; const showGerman = current.mode==='ende';
  const base=normalizeEN($('in_base').value||''); const past=normalizeEN($('in_past').value||''); const pp=normalizeEN($('in_pp').value||'');
  const deVal = showGerman? normDe(($('in_de')?.value)||'') : '';
  let okBase=true, okPast=true, okPP=true, okDe=true; let required=0;
  if(clue!=='base'){ required++; okBase = base===normalizeEN(v.base); mark('base', okBase, [v.base]); }
  if(clue!=='past'){ required++; okPast = v.past.has(past); mark('past', okPast, v.past); }
  if(clue!=='pp'){ required++; okPP = v.pp.has(pp); mark('pp', okPP, v.pp); }
  if(showGerman && clue!=='de'){ required++; okDe = v.deSet.has(deVal); mark('de', okDe, v.deSet, 'de'); }
  asked += required; const allOk = okBase && okPast && okPP && (showGerman? okDe : true);
  if(allOk){ sfx.correct(); streak++; correct+=required; $('streak').textContent=String(streak); $('acc').textContent=pct(correct/asked); idx++; next(); }
  else { sfx.wrong(); streak=0; $('streak').textContent='0'; mistakes.push({base:v.base, clue, mode:current.mode, deOrig:v.de, user:{base:base||'—',past:past||'—',pp:pp||'—',de:($('in_de')?$('in_de').value:'—')}, correct:{base:v.base, past:[...v.past], pp:[...v.pp], de:[...v.deSet]}}); }
}
function mark(which,ok,set,kind='en'){ const inp=document.getElementById('in_'+which); if(!inp) return; const w=inp.parentElement, h=document.getElementById('help_'+which); w.classList.remove('correct','wrong'); h.textContent='';
  if(ok){ w.classList.add('correct'); h.textContent='Correct'; h.classList.add('correct'); }
  else { const ans = Array.isArray(set)? set : [...set]; const shown = (kind==='de')? ans.map(x=>restoreDe(x)).join(', ') : ans.join(', ');
    w.classList.add('wrong'); h.textContent='Correct: '+shown; h.classList.add('wrong'); }
}
function restoreDe(n){ return n.replace(/ae/g,'ä').replace(/oe/g,'ö').replace(/ue/g,'ü').replace(/ss/g,'ß'); }
function hint(){ const v=current.v; const clue=current.clue; const FL=s=>s[0];
  if(clue!=='base') document.getElementById('help_base').textContent='First letter: '+FL(v.base);
  if(clue!=='past') document.getElementById('help_past').textContent='First letter: '+FL(one(v.pastArr));
  if(clue!=='pp') document.getElementById('help_pp').textContent='First letter: '+FL(one(v.ppArr));
  if(current.mode==='ende' && clue!=='de') document.getElementById('help_de').textContent='First letter: '+FL(stripParensKeep(v.de).trim());
}
function one(a){ return a[0]; }
function pct(x){ return (Math.round(x*1000)/10).toFixed(1)+'%'; }
function sample(arr,n){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a.slice(0,n); }

function endRound(){ $('play').style.display='none'; const acc= asked? pct(correct/asked) : '—'; $('summary').style.display='block'; $('summarySubtitle').textContent=`Accuracy: ${acc} · Items answered: ${asked}`; renderMistakes(); sfx.end(); }
function renderMistakes(){ const wrap=$('mistakeWrap'), btn=$('retryMistakes'), table=$('mistakesTable'); if(mistakes.length===0){ wrap.style.display='none'; btn.style.display='none'; return; }
  wrap.style.display='block'; btn.style.display='inline-block'; table.innerHTML='<tr><th>Base</th><th>Mode</th><th>Clue</th><th>Your answers (base · past · pp · de)</th><th>Correct</th></tr>'+
    mistakes.map(m=>`<tr><td>${m.base}</td><td>${m.mode}</td><td>${clueLabel(m.clue)}</td><td>${m.user.base} · ${m.user.past} · ${m.user.pp} · ${m.user.de}</td><td>${m.correct.base} · ${m.correct.past.join(', ')} · ${m.correct.pp.join(', ')} · ${m.deOrig}</td></tr>`).join(''); }
$('retryMistakes').addEventListener('click', ()=>{ if(mistakes.length===0) return; pool = mistakes.map(m=>VERBS.find(v=>v.base===m.base)); idx=0; streak=0; correct=0; asked=0; mistakes=[]; $('total').textContent=pool.length; $('pos').textContent='0'; $('summary').style.display='none'; $('play').style.display='block'; next(); });
</script>
</body>
</html>
